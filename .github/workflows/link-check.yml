name: DVC Link Check
on: deployment_status

jobs:
  run:
    name: Run Link Checker
    runs-on: ubuntu-latest
    if: github.event.deployment_status.state == 'success'

    steps:
    - uses: actions/checkout@v2

    - name: Run the link checker
      id: check
      run: "./scripts/link-check-git-diff.sh"
      env:
        CHECK_LINKS_RELATIVE_URL: ${{ github.event.deployment_status.target_url }}

    - uses: LouisBrunner/checks-action@v0.1.0
      if: success()
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        name: Link Check
        conclusion: success

    - uses: LouisBrunner/checks-action@v0.1.0
      if: failure()
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        name: Link Check
        conclusion: failure
